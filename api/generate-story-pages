// /api/generate-story-pages.js

import Replicate from "replicate";

const replicate = new Replicate({
  auth: process.env.REPLICATE_API_TOKEN,
});

export default async function handler(req, res) {
  const { image, prompts } = req.body;

  if (!image || !prompts || !Array.isArray(prompts)) {
    return res.status(400).json({ error: "Missing image or prompts array." });
  }

  try {
    const results = await Promise.all(
      prompts.map(async (prompt) => {
        const output = await replicate.run("black-forest-labs/flux-kontext-max", {
          input: {
            prompt,
            input_image: image,
          },
        });
        return output; // This is the URL of the generated image
      })
    );

    res.status(200).json({ pages: results });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Failed to generate pages" });
  }
}
